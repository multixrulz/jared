<!DOCTYPE html>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css/layout.css">
<link rel="stylesheet" type="text/css" href="/css/gold.css">
<link rel="shortcut icon" href="/favicon.png">
<meta name="description" content="">
<meta name="generator" content="0cms">
<meta name="author" content="Jared Henley">
<meta name="copyright" content="&copy; 2019 Jared Henley">
<meta name="verify-v1" content="sOYDFF7yuYP5c4zAAejxDlHXwprCPvTXQ6CoRodicuQ=">
</head>
<body>
<div id="width">
    <div id="head">
        <div id="hd2">
            <img class="stretch" src="/img/headbg_gold.png" alt="background">
            <p>My blog</p>
            <img id="topimg" src="/img/sunflower.png" alt="nice pic">
        </div>
    </div>
    <div id="menu">
        <ul>
            <li><a href="/" title="Jared Henley's Website">Home</a></li>
            <li><a href="/blog" title="Jared Henley's blog">Blog</a></li>
            <li><a href="/geek/" title="Geeky Stuff">Geek</a></li>
            <li><a href="/stuff/" title="Other Stuff">Stuff</a></li>
            <li><a href="/software/" title="Software">Software</a></li>
        </ul>
    </div>
    <div id="trail">
<ul>
<li><a href="/">Jared Henley</a></li>
<li><a href="/blog/">My blog</a></li>
</ul>
    </div>
    <div id="content">
<h1>Record my desktop with ffmpeg</h1>
<p>It seems that desktop recording is quite the pest.  Not that I’ve tried much, but I also haven’t really found a &ldquo;go-to&rdquo; piece of software for X11 that just does it.  So the last time I wanted to record my screen, I decided to have a go with just plain command-line tools.</p>
<p>It turns out that this is also ridiculously easy.</p>
<pre><code>ffmpeg -f x11grab -s 500x300 -r 25 -i :0.0 foo.mp4
</code></pre>

<p>The -s option tells ffmpeg the pixel size of the region you want to grab; -r is the frame rate, -i is your X screen, and the video is written to foo.mp4.</p>
<p>If you don’t want to start the screen capture in the top-left, just use something like <code>-i :0.0+100,200</code> to specify where to start and the resolution to capture.</p>
<p>The <a href="https://trac.ffmpeg.org/wiki/Capture/Desktop">ffmpeg website</a> has more info.</p>
<p class="blogdate">Posted Tuesday, February 19, 2019</p>
<h1>Find and replace in geany</h1>
<p>The other day I wanted to do a find-and-replace in <a href="http://www.geany.org/">geany</a> using a regex in the find.  I wanted to turn something like this</p>
<pre><code>Field name: value
</code></pre>

<p>into</p>
<pre><code>Field name: value plus some more
</code></pre>

<p>Since geany supports regex searching, I decided it was time to find out how to do regex replacements too.  The way it works, is that you put parentheses around each match that you want to be able to use in the replacement string, and then reference these replacements using backslash-number.  So the find string becomes</p>
<pre><code>^Field name: (.*)
</code></pre>

<p>and the replacement string becomes</p>
<pre><code>Field name:  plus some more
</code></pre>

<p>That was too easy.</p>
<p class="blogdate">Posted Monday, February 18, 2019</p>
<h1>Getting Void Linux to work right</h1>
<p>My experiment with Void Linux started very well.  There was the usual round of installing all the packages I needed to make the computer useful, and then there was the business of getting nonfunctional stuff to work.  Being that Void doesn’t modify packages, this was also an educational experience.</p>
<h2>The trackpad</h2>
<p>The trackpad on this computer was tracking too slowly for my liking.  I don’t know if it was due to Arch/Void differences, or just changes in xorg, but it really doesn’t matter.</p>
<p>I didn’t want to fix this with an X configuration file, primarily because it doesn’t live in my home directory and is thus vulnerable to disappearing with an OS install.</p>
<p>I discovered xinput, which allows you to query and set various input-related settings in a running X server.</p>
<p>To get a list of input devices:</p>
<pre><code>xinput
</code></pre>

<p>To see the available properties of a device (use the device name reported above):</p>
<pre><code>xinput list-props &lt;device name&gt;
</code></pre>

<p>To set a property:</p>
<pre><code>xinput set-prop &quot;ETPS/2 Elantech Touchpad&quot; 287 1
</code></pre>

<p>where &ldquo;ETPS/2 Elantech Touchpad&rdquo; is the device name, 287 is the number of the property to set, and 1 is the value I want there.</p>
<p>I run this in .xinitrc before starting xfce4.</p>
<h2>X display settings</h2>
<p>I discovered the wonders of xrandr some time ago, but it’s worth documenting.  With a laptop, you (or at least I) frequently end up connecting to a variety of different screens.  These are often TVs that just don’t correctly report their capabilities in the EDID (which is the way a monitor tells a computer its name, the resolutions it supports, etc).</p>
<p>To fix this, you can sometimes supply an EDID file to the kernel at boot, or edit the xorg configuration, or just use xrandr on a running X server.</p>
<p>To create a new mode, and assign it to a particular output use this:</p>
<pre><code>xrandr --newmode &quot;1920x1080 60Hz&quot; 148.500MHz 1920 2008 2052 2200 1080 1084 1089 1125 +HSync +VSync
xrandr --addmode DP-1 &quot;1920x1080 60Hz&quot;
</code></pre>

<p>You can get the output names by running xrandr with no arguments.  To get modelines, use the <code>gtf</code> or <code>cvt</code> programs.  The new mode will now be available in your favourite monitor-configuring tool, be that xrandr or your DE’s settings program.</p>
<p>I run this in .xinitrc before starting xfce4.</p>
<h2>Getting xfce4’s restart and shutdown buttons to work</h2>
<p>This one turned out to be easy.  You simply run <code>startxfce4</code> with the <code>--with-ck-launch</code> option.  I had tried this previously with no result, probably because some required package wasn’t installed.  I assume this was ConsoleKit, or maybe PolicyKit, and it would have been brought in as a dependency for something else.</p>
<p>For some reason, there are no suspend or hibernate buttons.  I don’t know if they’re compiled out in Void, or not being shown because those functions aren’t available.  I strongly suspect, due to what I’ve read, that these two rely on systemd to work.</p>
<h2>Fixing sound</h2>
<p>Intel HDA sound is always a pest.  My sound used to work in Arch, but that may have been due to some tweaking that got blown away when the root partition was reformatted.  My problem was that sound would go to the headphones when they weren’t plugged in but when they were plugged in, sound would go to the speakers.</p>
<p>I finally stumbled upon the awesome tool <code>hdajackretask</code>, which is a part of <code>alsa-tools</code>.  The snd-hda-intel module can be reconfigured on the fly by writing values to the correct section of <code>/sys</code>.  You just fiddle around in hdajackrestask until things seem to work right, then grab the shell script it creates from <code>/tmp/hda-jack-retask-??????/script.sh</code>.</p>
<p>I tweaked the script to stop it trying to write logging information to /tmp, and called it from <code>/etc/rc.local</code> in order to apply the sound changes at boot &ndash; oh the joy of having rc.local again!</p>
<h2>Automounting of USB drives</h2>
<p>I’ve been using devmon and udevil for years.  With systemd there’s some bodgy-looking method for running devmon when a user logs in.  Without systemd you just put it in your .bashrc or equivalent shell startup script.  I’m using fish, so what I’ve ended up with is:</p>
<pre><code>pidof -x devmon &gt; /dev/null 2&gt;/dev/null
if test $status -ne 0
    echo &quot;Starting devmon&quot;
    devmon -g &amp;
end
</code></pre>

<p>This typically starts devmon when I log in, and logging out should kill it.</p>
<p class="blogdate">Posted Tuesday, January 22, 2019</p>
<h1>Entering the Void</h1>
<p>Or, my experiment with Void Linux.</p>
<p>With a 32-bit computer and ArchLinux now 64-bit only, it’s time to try something that will run on the old CPU.  I picked Void Linux because it’s very basic (like Arch), and doesn’t have systemd.  I’m not a great fan of systemd, in part because of the usual complaints, but moreso because it is another milestone on the road to ruining everything that was good about Linux (ie, user control over the system &ndash; most distros seem to have this big blob (or set of big blobs) in the middle that are hard to figure out and not very modular).</p>
<p>The void installer was very good.  So good, in fact, that there’s nothing to report.  It just got the job done.</p>
<p>The next step was to configure /etc/crypttab to unlock my encrypted /home partition.  That was also simplicity itself.</p>
<p>Void Linux is very Arch-like in many ways.  The main thing to do was to get extra packages to have a working system.  Are there any issues?</p>
<ul>
<li>
<p>I had a little trouble with NetworkManager.  First, it required dbus, no surprise there, but I had to tell it to run myself (hooray!).  Second, there was some kind of issue with filesystem permissions to delete connections, but that resolved itself with either a reboot or adding myself to an appropriate group (no idea which one that was, though).</p>
</li>
<li>
<p>XFCE4 still doesn’t show a proper logout menu.  The restart and shutdown icons are greyed, and the suspend-to-RAM and hibernate buttons don’t show at all.  This is a typical problem with learning a new distro.  I’ll solve that later.</p>
</li>
</ul>
<p>So far that seems to be it.</p>
<p class="blogdate">Posted Thursday, January 17, 2019</p>
<h1>Removing gvfs</h1>
<p>It is possible (at least on my systems) to remove gvfs.  Why do this?  Well it doesn’t do anything useful for me, and it does leave processes lying around after logout.  One time it even held open files on a USB drive, which is a real pest when you want to remove it.</p>
<p>Getting rid of gvfs turned out to be really easy.  Nothing I use depends on it, although there are some optional dependencies.  Nothing I’ve been used to has stopped working, either.</p>
<p>Now if I can get rid of those other non-dying processes&hellip;</p>
<p class="blogdate">Posted Monday, December  5, 2016</p>
<p><a href="/blog/contents.html">Blog contents</a></p>
    </div>
    <div id="foot">

<form id="searchform" action="https://duckduckgo.com/" method="get">
<input id="searchform_q" name="_q" type="text" value="" />
<input id="searchformq" name="q" type="hidden" value="" />
<input type="button" value="Search" onclick="search()" />
<script>
function search() {
    document.getElementById("searchformq").value =
        document.getElementById("searchform_q").value
        + " site:jared.henley.id.au"
    document.getElementById("searchform").submit()
}
</script>
</form>

<p><strong>This website is Copyright &copy; 2005-2019 Jared Henley</strong></p>
<p>Built with <a href="http://0cms.henley.id.au">0cms</a>.  DNS by <a href="http://freedns.afraid.org/">afraid.org</a>.</p>
<p>All content is licenced <a href="http://creativecommons.org/licenses/by-nd/4.0/">CC-BY-ND</a> unless otherwise noted.  Code is licenced under <a href="https://www.gnu.org/licenses/gpl-3.0.en.html">GPLv3</a>. <a href="/credits.html">Credits</a></p>
<p><em>Last built: Tuesday, October  8, 2019 at 12:41:06</em></p>
<p><em>Last modified: Sunday, September 29, 2019 at 11:54:57</em></p>
</div>
</div>
</body>
</html>
